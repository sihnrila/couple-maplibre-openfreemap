# ë°°í¬ ê°€ì´ë“œ: Cloudflare Workers(D1) + Cloudflare Pages

ì™„ì „ ë¬´ë£Œ í‹°ì–´ ì¤‘ì‹¬ ì»¤í”Œ ì§€ë„ì•± ë°°í¬ ê°€ì´ë“œ

---

## 1) ë¡œì»¬ ì‹¤í–‰ ì²´í¬ë¦¬ìŠ¤íŠ¸

### A. í”„ë¡ íŠ¸ì—”ë“œ ì‹¤í–‰

```bash
# 1. ì˜ì¡´ì„± ì„¤ì¹˜
npm install

# 2. ê°œë°œ ì„œë²„ ì‹¤í–‰
npm run dev
```

- ê¸°ë³¸ ì£¼ì†Œ: `http://localhost:5173` (Vite ê¸°ë³¸ í¬íŠ¸)
- `.env` íŒŒì¼ì´ ì—†ì–´ë„ ìë™ìœ¼ë¡œ `http://127.0.0.1:8787`ì„ Worker ì£¼ì†Œë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.

### B. Worker ì‹¤í–‰ (ë³„ë„ í„°ë¯¸ë„)

```bash
# workers ë””ë ‰í† ë¦¬ì—ì„œ ì‹¤í–‰
npm run dev:worker
```

- ê¸°ë³¸ ì£¼ì†Œ: `http://127.0.0.1:8787`
- **ì£¼ì˜**: `workers/wrangler.toml`ì˜ `database_id`ê°€ ì„¤ì •ë˜ì–´ ìˆì–´ì•¼ D1 ì—°ê²°ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.

### C. ë¡œì»¬ ì‹¤í–‰ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] Node.js 20+ ì„¤ì¹˜ í™•ì¸ (`node --version`)
- [ ] `npm install` ì™„ë£Œ
- [ ] `workers/wrangler.toml`ì˜ `database_id` ì„¤ì • í™•ì¸
- [ ] í”„ë¡ íŠ¸ì—”ë“œ ì„œë²„ ì‹¤í–‰ (`npm run dev`)
- [ ] Worker ì„œë²„ ì‹¤í–‰ (`npm run dev:worker`)
- [ ] ë¸Œë¼ìš°ì €ì—ì„œ `http://localhost:5173` ì ‘ì†
- [ ] ì˜¨ë³´ë”© ëª¨ë‹¬ì´ í‘œì‹œë˜ëŠ”ì§€ í™•ì¸

---

### ìì£¼ ë‚˜ëŠ” ì—ëŸ¬ 7ê°œì™€ í•´ê²°ë²•

#### ì—ëŸ¬ 1: `Error: Cannot find module 'wrangler'`
**ì›ì¸**: wranglerê°€ ì„¤ì¹˜ë˜ì§€ ì•ŠìŒ
**í•´ê²°**:
```bash
npm install
# ë˜ëŠ”
npm install wrangler --save-dev
```

#### ì—ëŸ¬ 2: `Error: D1 database not found`
**ì›ì¸**: `workers/wrangler.toml`ì˜ `database_id`ê°€ `REPLACE_WITH_YOUR_D1_DATABASE_ID`ë¡œ ë‚¨ì•„ìˆìŒ
**í•´ê²°**: ì•„ë˜ "2) Cloudflare D1 ìµœì´ˆ ì„¸íŒ… ì ˆì°¨"ë¥¼ ë”°ë¼ `database_id`ë¥¼ ì‹¤ì œ ê°’ìœ¼ë¡œ êµì²´

#### ì—ëŸ¬ 3: `Error: Failed to execute D1 query`
**ì›ì¸**: D1 ë°ì´í„°ë² ì´ìŠ¤ê°€ ìƒì„±ë˜ì§€ ì•Šì•˜ê±°ë‚˜ ìŠ¤í‚¤ë§ˆê°€ ì ìš©ë˜ì§€ ì•ŠìŒ
**í•´ê²°**:
```bash
# D1 ìƒì„± í™•ì¸
npx wrangler d1 list

# ìŠ¤í‚¤ë§ˆ ì¬ì ìš©
npx wrangler d1 execute couplemap_db --file workers/schema.sql --config workers/wrangler.toml
```

#### ì—ëŸ¬ 4: `CORS error` ë˜ëŠ” `Network request failed`
**ì›ì¸**: Worker ì„œë²„ê°€ ì‹¤í–‰ë˜ì§€ ì•Šì•˜ê±°ë‚˜ í¬íŠ¸ê°€ ë‹¤ë¦„
**í•´ê²°**:
- Worker ì„œë²„ê°€ `http://127.0.0.1:8787`ì—ì„œ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸
- í”„ë¡ íŠ¸ì—”ë“œ ì½˜ì†”ì—ì„œ ì‹¤ì œ ìš”ì²­ URL í™•ì¸
- `.env` íŒŒì¼ì— `VITE_API_BASE=http://127.0.0.1:8787` ëª…ì‹œì ìœ¼ë¡œ ì„¤ì •

#### ì—ëŸ¬ 5: `TypeError: Cannot read property 'map' of undefined`
**ì›ì¸**: API ì‘ë‹µì´ ì˜ˆìƒê³¼ ë‹¤ë¥´ê±°ë‚˜ ì´ˆëŒ€ì½”ë“œê°€ ì—†ì–´ì„œ ì¿¼ë¦¬ê°€ ë¹„í™œì„±í™”ë¨
**í•´ê²°**:
- ë¸Œë¼ìš°ì € ê°œë°œì ë„êµ¬ Network íƒ­ì—ì„œ API ì‘ë‹µ í™•ì¸
- localStorageì— `inviteCode`ê°€ ìˆëŠ”ì§€ í™•ì¸
- ì˜¨ë³´ë”© ëª¨ë‹¬ì—ì„œ ì´ˆëŒ€ì½”ë“œ ìƒì„±/ì°¸ì—¬ ì™„ë£Œ

#### ì—ëŸ¬ 6: `Error: HTTP 401` ë˜ëŠ” `Error: HTTP 403`
**ì›ì¸**: ì´ˆëŒ€ì½”ë“œê°€ ìœ íš¨í•˜ì§€ ì•Šê±°ë‚˜ ë§Œë£Œë¨
**í•´ê²°**:
- localStorageì—ì„œ `inviteCode` ì‚­ì œ í›„ ì¬ìƒì„±
- Workerì—ì„œ `couples` í…Œì´ë¸”ì— í•´ë‹¹ ì´ˆëŒ€ì½”ë“œê°€ ìˆëŠ”ì§€ í™•ì¸
- ì´ˆëŒ€ì½”ë“œ ì¬ë°œê¸‰ (ì„¤ì • â†’ ì´ˆëŒ€ì½”ë“œ ì¬ë°œê¸‰)

#### ì—ëŸ¬ 7: `Error: Rate limited: try again in a second`
**ì›ì¸**: Nominatim API rate limit (1 req/sec) ì´ˆê³¼
**í•´ê²°**:
- 1ì´ˆ ëŒ€ê¸° í›„ ì¬ì‹œë„
- ê²€ìƒ‰ì–´ ì…ë ¥ ì‹œ ë””ë°”ìš´ìŠ¤ê°€ ì‘ë™í•˜ë¯€ë¡œ ìì—°ìŠ¤ëŸ½ê²Œ í•´ê²°ë¨
- Worker ì½”ë“œì˜ rate limit ë¡œì§ì€ ì •ìƒ ì‘ë™ ì¤‘

---

## 2) Cloudflare D1 ìµœì´ˆ ì„¸íŒ… ì ˆì°¨

### ë‹¨ê³„ë³„ ì‹¤í–‰

```bash
# 1. Cloudflare ë¡œê·¸ì¸
npx wrangler login
# ë¸Œë¼ìš°ì €ê°€ ì—´ë¦¬ë©´ Cloudflare ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸

# 2. D1 ë°ì´í„°ë² ì´ìŠ¤ ìƒì„±
npx wrangler d1 create couplemap_db
```

**ì¶œë ¥ ì˜ˆì‹œ**:
```
âœ… Successfully created DB 'couplemap_db'!

[[d1_databases]]
binding = "DB"
database_name = "couplemap_db"
database_id = "a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6"
```

### 3. `workers/wrangler.toml` ìˆ˜ì •

**íŒŒì¼ ìœ„ì¹˜**: `workers/wrangler.toml`

**ìˆ˜ì •í•  ë¶€ë¶„** (10ë²ˆì§¸ ì¤„):
```toml
# ë³€ê²½ ì „
database_id = "REPLACE_WITH_YOUR_D1_DATABASE_ID"

# ë³€ê²½ í›„ (ìœ„ì—ì„œ ë°›ì€ database_idë¡œ êµì²´)
database_id = "a1b2c3d4e5f6g7h8i9j0k1l2m3n4o5p6"
```

### 4. ìŠ¤í‚¤ë§ˆ ì ìš©

```bash
npx wrangler d1 execute couplemap_db --file workers/schema.sql --config workers/wrangler.toml
```

**ì„±ê³µ ë©”ì‹œì§€**:
```
âœ… Successfully executed 9 commands
```

**í™•ì¸ ë°©ë²•**:
```bash
# D1 ë°ì´í„°ë² ì´ìŠ¤ ëª©ë¡ í™•ì¸
npx wrangler d1 list

# íŠ¹ì • ë°ì´í„°ë² ì´ìŠ¤ ì •ë³´ í™•ì¸
npx wrangler d1 info couplemap_db --config workers/wrangler.toml
```

---

## 3) Workers ë°°í¬ ì ˆì°¨

### ë°°í¬ ëª…ë ¹ì–´

```bash
npm run deploy:worker
```

ë˜ëŠ” ì§ì ‘ ì‹¤í–‰:
```bash
wrangler deploy --config workers/wrangler.toml
```

### ë°°í¬ í›„ Worker URL í™•ì¸ ë°©ë²•

**ë°©ë²• 1: ë°°í¬ ì¶œë ¥ì—ì„œ í™•ì¸**
```
âœ¨ Compiled Worker successfully
ğŸŒ Uploading...
âœ¨ Uploaded successfully
ğŸš€ Deployed to https://couplemap-api.YOUR_SUBDOMAIN.workers.dev
```

**ë°©ë²• 2: Cloudflare Dashboardì—ì„œ í™•ì¸**
1. [Cloudflare Dashboard](https://dash.cloudflare.com) ì ‘ì†
2. Workers & Pages â†’ Workers íƒ­
3. `couplemap-api` ì„ íƒ
4. "Triggers" ì„¹ì…˜ì—ì„œ URL í™•ì¸

**ë°©ë²• 3: wrangler ëª…ë ¹ì–´ë¡œ í™•ì¸**
```bash
npx wrangler deployments list --config workers/wrangler.toml
```

### Worker URL ì˜ˆì‹œ
```
https://couplemap-api.your-subdomain.workers.dev
```

**ì¤‘ìš”**: ì´ URLì„ ë³µì‚¬í•´ì„œ ì•„ë˜ "5) Pages í™˜ê²½ë³€ìˆ˜ ì„¸íŒ…"ì—ì„œ ì‚¬ìš©í•©ë‹ˆë‹¤.

---

## 4) Pages ë°°í¬ ì ˆì°¨ (Cloudflare Pages)

### A. GitHub ì €ì¥ì†Œ ì¤€ë¹„

1. GitHubì— ì €ì¥ì†Œ ìƒì„± (ì˜ˆ: `couple-maplibre-openfreemap`)
2. ë¡œì»¬ ì½”ë“œ í‘¸ì‹œ:
```bash
git init
git add .
git commit -m "Initial commit"
git branch -M main
git remote add origin https://github.com/YOUR_USERNAME/couple-maplibre-openfreemap.git
git push -u origin main
```

### B. Cloudflare Pages ì—°ê²°

1. [Cloudflare Dashboard](https://dash.cloudflare.com) ì ‘ì†
2. **Workers & Pages** â†’ **Pages** â†’ **Create a project**
3. **Connect to Git** ì„ íƒ
4. GitHub ê³„ì • ì—°ê²° ë° ì €ì¥ì†Œ ì„ íƒ
5. **Build settings** ì…ë ¥:

   **Build command**:
   ```
   npm ci && npm run build
   ```

   **Build output directory**:
   ```
   dist
   ```

   **Root directory** (ì„ íƒì‚¬í•­):
   ```
   /
   ```

6. **Environment variables**ëŠ” ë‹¤ìŒ ë‹¨ê³„ì—ì„œ ì„¤ì • (ì§€ê¸ˆì€ ê±´ë„ˆë›°ê¸°)
7. **Save and Deploy** í´ë¦­

### C. Node ë²„ì „ ì„¤ì •

**ê¶Œì¥**: Node.js 20 ì´ìƒ

**ì„¤ì • ë°©ë²•**:
1. Pages í”„ë¡œì íŠ¸ â†’ **Settings** â†’ **Builds & deployments**
2. **Environment variables** ì„¹ì…˜ì—ì„œ:
   - Key: `NODE_VERSION`
   - Value: `20` (ë˜ëŠ” `22`)

ë˜ëŠ” `package.json`ì— `engines` í•„ë“œ ì¶”ê°€:
```json
{
  "engines": {
    "node": ">=20.0.0"
  }
}
```

### D. ë°°í¬ í™•ì¸

- ë°°í¬ ì™„ë£Œ í›„ Pages URL í™•ì¸ (ì˜ˆ: `https://couple-maplibre-openfreemap.pages.dev`)
- ì²« ë°°í¬ëŠ” ì‹¤íŒ¨í•  ìˆ˜ ìˆìŒ (í™˜ê²½ë³€ìˆ˜ ë¯¸ì„¤ì •) â†’ ë‹¤ìŒ ë‹¨ê³„ ì§„í–‰

---

## 5) Pages í™˜ê²½ë³€ìˆ˜ ì„¸íŒ… (ì¤‘ìš”)

### í•„ìˆ˜ í™˜ê²½ë³€ìˆ˜

**Key**: `VITE_API_BASE`
**Value**: ë°°í¬ëœ Worker URL (ì˜ˆ: `https://couplemap-api.your-subdomain.workers.dev`)

### ì„¤ì • ë°©ë²•

1. Cloudflare Dashboard â†’ **Workers & Pages** â†’ **Pages**
2. í”„ë¡œì íŠ¸ ì„ íƒ â†’ **Settings** â†’ **Environment variables**
3. **Add variable** í´ë¦­
4. ì…ë ¥:
   - **Variable name**: `VITE_API_BASE`
   - **Value**: `https://couplemap-api.your-subdomain.workers.dev` (ìœ„ì—ì„œ ë³µì‚¬í•œ Worker URL)
5. **Save** í´ë¦­
6. **Retry deployment** ë˜ëŠ” ìƒˆ ì»¤ë°‹ í‘¸ì‹œë¡œ ì¬ë°°í¬

### í™˜ê²½ë³€ìˆ˜ í™•ì¸

ë°°í¬ í›„ ë¸Œë¼ìš°ì € ê°œë°œì ë„êµ¬ Consoleì—ì„œ:
```javascript
console.log(import.meta.env.VITE_API_BASE);
// ì˜ˆìƒ ì¶œë ¥: "https://couplemap-api.your-subdomain.workers.dev"
```

### ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ê¸°ë°˜ ë°ì´í„° (í™˜ê²½ë³€ìˆ˜ ë¶ˆí•„ìš”)

ë‹¤ìŒ ë°ì´í„°ëŠ” **localStorage**ì— ì €ì¥ë˜ë¯€ë¡œ Pages í™˜ê²½ë³€ìˆ˜ ì„¤ì •ì´ **í•„ìš” ì—†ìŠµë‹ˆë‹¤**:
- `inviteCode`: ì´ˆëŒ€ì½”ë“œ (localStorage)
- `theme_base_style`: í…Œë§ˆ ê¸°ë³¸ ìŠ¤íƒ€ì¼ (localStorage)
- `theme_overlay`: ì˜¤ë²„ë ˆì´ íš¨ê³¼ (localStorage)

**ì£¼ì˜**: ê° ë¸Œë¼ìš°ì €/ê¸°ê¸°ë§ˆë‹¤ ë³„ë„ë¡œ ì €ì¥ë˜ë¯€ë¡œ, ìƒˆ ê¸°ê¸°ì—ì„œëŠ” ì´ˆëŒ€ì½”ë“œë¥¼ ë‹¤ì‹œ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.

---

## 6) Nominatim ì •ì±… ì¤€ìˆ˜ í•­ëª© ì²´í¬

### í•„ìˆ˜ ìˆ˜ì •: User-Agent Contact ì´ë©”ì¼

**íŒŒì¼**: `workers/src/index.ts`
**ë¼ì¸**: 89ë²ˆì§¸ ì¤„

**í˜„ì¬ ì½”ë“œ**:
```typescript
"user-agent": "CoupleMap/0.2 (contact: example@example.com)",
```

**ìˆ˜ì • ë°©ë²•**:
```typescript
"user-agent": "CoupleMap/0.2 (contact: your-email@example.com)",
```

**ì£¼ì˜ì‚¬í•­**:
- `your-email@example.com`ì„ **ì‹¤ì œ ì´ë©”ì¼ ì£¼ì†Œ**ë¡œ ë°˜ë“œì‹œ ë³€ê²½
- Nominatim ì •ì±… ìœ„ë°˜ ì‹œ IP ì°¨ë‹¨ ê°€ëŠ¥
- ì´ë©”ì¼ì€ ê³µê°œë˜ì–´ë„ ë˜ì§€ë§Œ, ìŠ¤íŒ¸ ë°©ì§€ë¥¼ ìœ„í•´ ë³„ë„ ì´ë©”ì¼ ì‚¬ìš© ê¶Œì¥

### Rate Limit í™•ì¸

**í˜„ì¬ êµ¬í˜„**: 1 req/sec (Worker ë‹¨ìœ„)

**í™•ì¸ ìœ„ì¹˜**: `workers/src/index.ts` 75-78ë²ˆì§¸ ì¤„
```typescript
const now = Date.now();
if (now - lastGeocodeAt < 950) {
  return bad("Rate limited: try again in a second.", 429);
}
```

**ì •ìƒ ì‘ë™ í™•ì¸**:
- í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ê²€ìƒ‰ ì‹œ ë””ë°”ìš´ìŠ¤(450ms) ì ìš©ë¨
- Workerì—ì„œ 1ì´ˆë‹¹ 1íšŒ ì œí•œ ì ìš©ë¨
- 2ëª… ì‚¬ìš© ê¸°ì¤€ìœ¼ë¡œ ì¶©ë¶„í•¨

### ì¶”ê°€ í™•ì¸ì‚¬í•­

- [ ] User-Agent contact ì´ë©”ì¼ ë³€ê²½ ì™„ë£Œ
- [ ] Rate limit ë¡œì§ ìœ ì§€ (1 req/sec)
- [ ] í”„ë¡ íŠ¸ì—”ë“œ ë””ë°”ìš´ìŠ¤ ì‘ë™ í™•ì¸
- [ ] Nominatim ê³µê°œ API ì •ì±… ì¤€ìˆ˜ í™•ì¸: https://operations.osmfoundation.org/policies/nominatim/

---

## 7) ìµœì¢… ê²€ì¦ ì‹œë‚˜ë¦¬ì˜¤ 12ê°œ (ë¸Œë¼ìš°ì € A/B)

### ì¤€ë¹„
- **ë¸Œë¼ìš°ì € A**: ì‹œí¬ë¦¿/í”„ë¼ì´ë¹— ëª¨ë“œ (ë˜ëŠ” ë‹¤ë¥¸ ë¸Œë¼ìš°ì €)
- **ë¸Œë¼ìš°ì € B**: ì‹œí¬ë¦¿/í”„ë¼ì´ë¹— ëª¨ë“œ (ë˜ëŠ” ë‹¤ë¥¸ ë¸Œë¼ìš°ì €)
- ë‘ ë¸Œë¼ìš°ì € ëª¨ë‘ ë°°í¬ëœ Pages URL ì ‘ì†

---

### ì‹œë‚˜ë¦¬ì˜¤ 1: ì»¤í”Œ ìƒì„± (ë¸Œë¼ìš°ì € A)
1. ì˜¨ë³´ë”© ëª¨ë‹¬ í‘œì‹œ í™•ì¸
2. "ì»¤í”Œ ë§Œë“¤ê¸°" í´ë¦­
3. ì´ˆëŒ€ì½”ë“œ ë°œê¸‰ í™•ì¸ (ì˜ˆ: `ABC12345`)
4. ì´ˆëŒ€ì½”ë“œ ë³µì‚¬

**âœ… ì„±ê³µ ê¸°ì¤€**: ì´ˆëŒ€ì½”ë“œê°€ í‘œì‹œë˜ê³  ëª¨ë‹¬ì´ ë‹«í˜

---

### ì‹œë‚˜ë¦¬ì˜¤ 2: ì´ˆëŒ€ì½”ë“œë¡œ ì°¸ì—¬ (ë¸Œë¼ìš°ì € B)
1. ì˜¨ë³´ë”© ëª¨ë‹¬ í‘œì‹œ í™•ì¸
2. "ì´ˆëŒ€ì½”ë“œë¡œ ì°¸ì—¬" í´ë¦­
3. ë¸Œë¼ìš°ì € Aì—ì„œ ë³µì‚¬í•œ ì´ˆëŒ€ì½”ë“œ ì…ë ¥
4. "ì°¸ì—¬í•˜ê¸°" í´ë¦­

**âœ… ì„±ê³µ ê¸°ì¤€**: ëª¨ë‹¬ì´ ë‹«íˆê³  ì§€ë„ í™”ë©´ í‘œì‹œ

---

### ì‹œë‚˜ë¦¬ì˜¤ 3: í´ë” ìƒì„± (ë¸Œë¼ìš°ì € A)
1. ì„¤ì • ë²„íŠ¼(âš™ï¸) í´ë¦­
2. "ğŸ“ í´ë” ê´€ë¦¬" í´ë¦­
3. í”„ë¦¬ì…‹ ë²„íŠ¼ ì¤‘ í•˜ë‚˜ í´ë¦­ (ì˜ˆ: "ë§›ì§‘")
4. ìƒ‰ìƒ ì„ íƒ (ì˜ˆ: #FF6B6B)
5. ì•„ì´ì½˜ ì„ íƒ (ì˜ˆ: "heart" â¤ï¸)
6. "ì¶”ê°€í•˜ê¸°" í´ë¦­

**âœ… ì„±ê³µ ê¸°ì¤€**: í´ë” ëª©ë¡ì— ìƒˆ í´ë” í‘œì‹œ, ìƒ‰ìƒ/ì•„ì´ì½˜ ë°˜ì˜

---

### ì‹œë‚˜ë¦¬ì˜¤ 4: í´ë” ìˆ˜ì • (ë¸Œë¼ìš°ì € A)
1. í´ë” ê´€ë¦¬ ì‹œíŠ¸ì—ì„œ í´ë”ì˜ "ìˆ˜ì •" ë²„íŠ¼ í´ë¦­
2. ì´ë¦„ ë³€ê²½ (ì˜ˆ: "ë§›ì§‘" â†’ "ë§›ì§‘ ì¶”ì²œ")
3. "ì €ì¥" í´ë¦­

**âœ… ì„±ê³µ ê¸°ì¤€**: í´ë” ì´ë¦„ì´ ë³€ê²½ë¨

---

### ì‹œë‚˜ë¦¬ì˜¤ 5: ì¥ì†Œ ì €ì¥ + í´ë” ì§€ì • (ë¸Œë¼ìš°ì € A)
1. ê²€ìƒ‰ì°½ì— ì¥ì†Œ ì…ë ¥ (ì˜ˆ: "ê°•ë‚¨ì—­")
2. ê²€ìƒ‰ ê²°ê³¼ì—ì„œ ì¥ì†Œ ì„ íƒ
3. ì €ì¥ ì¹´ë“œì—ì„œ:
   - í´ë” ì„¹ì…˜ì—ì„œ ìœ„ì—ì„œ ë§Œë“  í´ë” ì„ íƒ
   - ì œëª© ì…ë ¥ (ì˜ˆ: "ìš°ë¦¬ì˜ ì²« ì¹´í˜")
   - íƒœê·¸ ì¶”ê°€ (ì˜ˆ: "ì¹´í˜")
   - ë©”ëª¨ ì…ë ¥
4. "ì €ì¥í•˜ê¸°" í´ë¦­

**âœ… ì„±ê³µ ê¸°ì¤€**: 
- ì €ì¥ ì„±ê³µ ë©”ì‹œì§€
- ì§€ë„ì— ë§ˆì»¤ í‘œì‹œ
- ë§ˆì»¤ ìƒ‰ìƒì´ í´ë” ìƒ‰ìƒ(#FF6B6B)ê³¼ ì¼ì¹˜

---

### ì‹œë‚˜ë¦¬ì˜¤ 6: ë¸Œë¼ìš°ì € Bì—ì„œ ë™ì¼ ë°ì´í„° í™•ì¸
1. ë¸Œë¼ìš°ì € B ìƒˆë¡œê³ ì¹¨
2. ì§€ë„ì— ë§ˆì»¤ í‘œì‹œ í™•ì¸
3. ë§ˆì»¤ ìƒ‰ìƒì´ í´ë” ìƒ‰ìƒê³¼ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸
4. ë§ˆì»¤ í´ë¦­ ì‹œ íŒì—…ì— ì œëª©/ë©”ëª¨ í‘œì‹œ í™•ì¸

**âœ… ì„±ê³µ ê¸°ì¤€**: ë¸Œë¼ìš°ì € Aì™€ ë™ì¼í•œ ë°ì´í„° í‘œì‹œ

---

### ì‹œë‚˜ë¦¬ì˜¤ 7: ë§ˆì»¤ ìƒ‰ìƒ í™•ì¸ (ë¸Œë¼ìš°ì € A)
1. ì—¬ëŸ¬ í´ë” ìƒì„± (ê°ê° ë‹¤ë¥¸ ìƒ‰ìƒ)
2. ê° í´ë”ì— ì¥ì†Œ ì €ì¥
3. ì§€ë„ì—ì„œ ë§ˆì»¤ ìƒ‰ìƒ í™•ì¸

**âœ… ì„±ê³µ ê¸°ì¤€**: ê° ë§ˆì»¤ê°€ í•´ë‹¹ í´ë” ìƒ‰ìƒìœ¼ë¡œ í‘œì‹œë¨

---

### ì‹œë‚˜ë¦¬ì˜¤ 8: ì•„ì´ì½˜ ë°˜ì˜ í™•ì¸ (ë¸Œë¼ìš°ì € A)
1. í´ë” ìƒì„± ì‹œ ì•„ì´ì½˜ ì„ íƒ:
   - "sparkle" (âœ¨)
   - "heart" (â¤ï¸)
2. ê° í´ë”ì— ì¥ì†Œ ì €ì¥
3. ì €ì¥ ì¹´ë“œì—ì„œ í´ë” ì„ íƒ ì‹œ ì•„ì´ì½˜ í‘œì‹œ í™•ì¸

**âœ… ì„±ê³µ ê¸°ì¤€**: í´ë” ì¹©ì— ì´ëª¨ì§€ ì•„ì´ì½˜ í‘œì‹œë¨

---

### ì‹œë‚˜ë¦¬ì˜¤ 9: ì´ˆëŒ€ì½”ë“œ ì¬ë°œê¸‰ (ë¸Œë¼ìš°ì € A)
1. ì„¤ì • â†’ ì´ˆëŒ€ì½”ë“œ í‘œì‹œ
2. í˜„ì¬ ì´ˆëŒ€ì½”ë“œ ë³µì‚¬
3. "ì´ˆëŒ€ì½”ë“œ ì¬ë°œê¸‰" í´ë¦­
4. í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸ì—ì„œ "í™•ì¸"
5. ìƒˆ ì´ˆëŒ€ì½”ë“œ í™•ì¸

**âœ… ì„±ê³µ ê¸°ì¤€**: ìƒˆ ì´ˆëŒ€ì½”ë“œ ë°œê¸‰, ê¸°ì¡´ ì½”ë“œì™€ ë‹¤ë¦„

---

### ì‹œë‚˜ë¦¬ì˜¤ 10: ì¬ë°œê¸‰ í›„ ê¸°ì¡´ ì½”ë“œ ë¬´íš¨í™” í™•ì¸ (ë¸Œë¼ìš°ì € B)
1. ë¸Œë¼ìš°ì € Bì—ì„œ localStorage ì´ˆëŒ€ì½”ë“œ ì‚­ì œ (ê°œë°œì ë„êµ¬)
2. ì˜¨ë³´ë”© ëª¨ë‹¬ì—ì„œ **ì´ì „ ì´ˆëŒ€ì½”ë“œ** ì…ë ¥
3. "ì°¸ì—¬í•˜ê¸°" í´ë¦­

**âœ… ì„±ê³µ ê¸°ì¤€**: ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ (404 ë˜ëŠ” "Invalid invite code")

---

### ì‹œë‚˜ë¦¬ì˜¤ 11: í…Œë§ˆ Base Style ë³€ê²½ (ë¸Œë¼ìš°ì € A)
1. ì„¤ì • â†’ "ğŸ¨ í…Œë§ˆ ì„¤ì •"
2. "ğŸŒ™ ë‹¤í¬" ì„ íƒ
3. ì§€ë„ ìŠ¤íƒ€ì¼ ë³€ê²½ í™•ì¸

**âœ… ì„±ê³µ ê¸°ì¤€**: ì§€ë„ê°€ ë‹¤í¬ í…Œë§ˆ(liberty)ë¡œ ë³€ê²½ë¨

---

### ì‹œë‚˜ë¦¬ì˜¤ 12: ì˜¤ë²„ë ˆì´ íš¨ê³¼ ì ìš© (ë¸Œë¼ìš°ì € A)
1. í…Œë§ˆ ì„¤ì •ì—ì„œ:
   - "ê·¸ë ˆì¸" ì„ íƒ â†’ ì§€ë„ì— ë…¸ì´ì¦ˆ íš¨ê³¼ í™•ì¸
   - "ë¹„ë„¤íŠ¸" ì„ íƒ â†’ ê°€ì¥ìë¦¬ ì–´ë‘ì›Œì§ í™•ì¸
   - "ë‚˜ì´íŠ¸ í‹´íŠ¸" ì„ íƒ â†’ í‘¸ë¥¸ í‹´íŠ¸ íš¨ê³¼ í™•ì¸
2. ë¸Œë¼ìš°ì € Bì—ì„œë„ ë™ì¼í•œ íš¨ê³¼ í‘œì‹œë˜ëŠ”ì§€ í™•ì¸ (localStorageëŠ” ê¸°ê¸°ë³„)

**âœ… ì„±ê³µ ê¸°ì¤€**: ê° ì˜¤ë²„ë ˆì´ íš¨ê³¼ê°€ ì‹œê°ì ìœ¼ë¡œ ì ìš©ë¨

---

## 8) ë¹„ìš© 0ì› ìœ ì§€ ê´€ì  ê²½ê³  3ê°œ

### ê²½ê³  1: Cloudflare Workers ë¬´ë£Œ í•œë„

**ë¬´ë£Œ í‹°ì–´ í•œë„**:
- **ìš”ì²­ ìˆ˜**: 100,000 ìš”ì²­/ì¼
- **CPU ì‹œê°„**: 10ms/ìš”ì²­ (í‰ê· )
- **ë©”ëª¨ë¦¬**: 128MB/ìš”ì²­

**2ëª… ì‚¬ìš© ê¸°ì¤€ ì˜ˆìƒ**:
- ì¼ì¼ ìš”ì²­: ì•½ 500-2,000íšŒ (ê²€ìƒ‰, ì¥ì†Œ ì¡°íšŒ, í´ë” ê´€ë¦¬ ë“±)
- **ì•ˆì „**: ë¬´ë£Œ í•œë„ ë‚´ì—ì„œ ì¶©ë¶„íˆ ì‚¬ìš© ê°€ëŠ¥

**í•œë„ ì´ˆê³¼ ì‹œ**:
- ìš”ì²­ì´ **ì—ëŸ¬(429 ë˜ëŠ” 503)**ë¡œ ì‹¤íŒ¨
- **ê³¼ê¸ˆ ì—†ìŒ** (ë¬´ë£Œ í”Œëœì€ ìë™ ì—…ê·¸ë ˆì´ë“œ ì•ˆ ë¨)
- ë‹¤ìŒ ë‚  ìì •(UTC)ì— ë¦¬ì…‹

**ëª¨ë‹ˆí„°ë§ ë°©ë²•**:
1. Cloudflare Dashboard â†’ Workers & Pages â†’ Analytics
2. ì¼ì¼ ìš”ì²­ ìˆ˜ í™•ì¸
3. 80,000 ìš”ì²­/ì¼ ì´ìƒ ì‹œ ê²½ê³ 

**ëŒ€ì‘ ë°©ë²•**:
- ë¶ˆí•„ìš”í•œ API í˜¸ì¶œ ìµœì†Œí™” (React Query ìºì‹± í™œìš©)
- ë””ë°”ìš´ìŠ¤/ì“°ë¡œí‹€ë§ ìœ ì§€
- í•œë„ ì´ˆê³¼ ì‹œ ë‹¤ìŒ ë‚ ê¹Œì§€ ëŒ€ê¸°

---

### ê²½ê³  2: Cloudflare D1 ë¬´ë£Œ í•œë„

**ë¬´ë£Œ í‹°ì–´ í•œë„**:
- **ì €ì¥ ìš©ëŸ‰**: 5GB
- **ì½ê¸° ì‘ì—…**: 5,000,000/ì¼
- **ì“°ê¸° ì‘ì—…**: 100,000/ì¼

**2ëª… ì‚¬ìš© ê¸°ì¤€ ì˜ˆìƒ**:
- ì €ì¥ ìš©ëŸ‰: ì•½ 10-50MB (ì¥ì†Œ 1,000ê°œ ê¸°ì¤€ ì•½ 1MB)
- ì¼ì¼ ì½ê¸°: ì•½ 10,000-50,000íšŒ
- ì¼ì¼ ì“°ê¸°: ì•½ 100-1,000íšŒ

**ì•ˆì „**: ë¬´ë£Œ í•œë„ ë‚´ì—ì„œ ì¶©ë¶„íˆ ì‚¬ìš© ê°€ëŠ¥

**í•œë„ ì´ˆê³¼ ì‹œ**:
- ì¿¼ë¦¬ê°€ **ì—ëŸ¬(500 ë˜ëŠ” 503)**ë¡œ ì‹¤íŒ¨
- **ê³¼ê¸ˆ ì—†ìŒ** (ë¬´ë£Œ í”Œëœì€ ìë™ ì—…ê·¸ë ˆì´ë“œ ì•ˆ ë¨)
- ë‹¤ìŒ ë‚  ìì •(UTC)ì— ë¦¬ì…‹

**ëª¨ë‹ˆí„°ë§ ë°©ë²•**:
1. Cloudflare Dashboard â†’ Workers & Pages â†’ D1
2. ë°ì´í„°ë² ì´ìŠ¤ ì„ íƒ â†’ Analytics
3. ì¼ì¼ ì½ê¸°/ì“°ê¸° ì‘ì—… ìˆ˜ í™•ì¸

**ëŒ€ì‘ ë°©ë²•**:
- ë¶ˆí•„ìš”í•œ ë°ì´í„° ì‚­ì œ (ì˜¤ë˜ëœ ì¥ì†Œ ì •ë¦¬)
- ì¸ë±ìŠ¤ í™œìš©ìœ¼ë¡œ ì½ê¸° ìµœì í™” (ì´ë¯¸ ì ìš©ë¨)
- í•œë„ ì´ˆê³¼ ì‹œ ë‹¤ìŒ ë‚ ê¹Œì§€ ëŒ€ê¸°

---

### ê²½ê³  3: Nominatim ì •ì±… ìœ„ë°˜ ìœ„í—˜

**Nominatim ê³µê°œ API ì •ì±…**:
- **Rate limit**: 1 req/sec (ì´ë¯¸ êµ¬í˜„ë¨)
- **User-Agent í•„ìˆ˜**: contact ì´ë©”ì¼ í¬í•¨ (ìˆ˜ì • í•„ìš”)
- **ì •ì±… ìœ„ë°˜ ì‹œ**: IP ì°¨ë‹¨ ê°€ëŠ¥

**ìœ„ë°˜ ìœ„í—˜ ìƒí™©**:
1. User-Agent contact ì´ë©”ì¼ ë¯¸ë³€ê²½
2. Rate limit ìš°íšŒ ì‹œë„
3. ëŒ€ëŸ‰ ìë™í™” ìš”ì²­

**IP ì°¨ë‹¨ ì‹œ**:
- ëª¨ë“  Nominatim ìš”ì²­ì´ **ì—ëŸ¬(403 ë˜ëŠ” 429)**ë¡œ ì‹¤íŒ¨
- **ë³µêµ¬ ë¶ˆê°€ëŠ¥** (IP ì°¨ë‹¨ì€ ìˆ˜ë™ í•´ì œ í•„ìš”)
- ëŒ€ì•ˆ: ë‹¤ë¥¸ ì§€ì˜¤ì½”ë”© ì„œë¹„ìŠ¤ ì‚¬ìš© (ìœ ë£Œ ê°€ëŠ¥ì„±)

**ì˜ˆë°© ë°©ë²•**:
- âœ… User-Agent contact ì´ë©”ì¼ ë°˜ë“œì‹œ ë³€ê²½ (6ë²ˆ í•­ëª© ì°¸ê³ )
- âœ… Rate limit ë¡œì§ ìœ ì§€ (1 req/sec)
- âœ… í”„ë¡ íŠ¸ì—”ë“œ ë””ë°”ìš´ìŠ¤ ìœ ì§€ (450ms)
- âœ… ìë™í™” ìŠ¤í¬ë¦½íŠ¸ ì‚¬ìš© ê¸ˆì§€

**ëª¨ë‹ˆí„°ë§**:
- Worker ë¡œê·¸ì—ì„œ 429 ì—ëŸ¬ í™•ì¸
- ë¸Œë¼ìš°ì € ì½˜ì†”ì—ì„œ "Rate limited" ë©”ì‹œì§€ í™•ì¸
- ì •ìƒ ì‘ë™ ì‹œ 429 ì—ëŸ¬ëŠ” ê±°ì˜ ì—†ìŒ

---

## ìµœì¢… ì²´í¬ë¦¬ìŠ¤íŠ¸

ë°°í¬ ì „ í™•ì¸:
- [ ] D1 ë°ì´í„°ë² ì´ìŠ¤ ìƒì„± ë° ìŠ¤í‚¤ë§ˆ ì ìš© ì™„ë£Œ
- [ ] Worker ë°°í¬ ì™„ë£Œ ë° URL í™•ì¸
- [ ] Pages ë°°í¬ ì™„ë£Œ
- [ ] `VITE_API_BASE` í™˜ê²½ë³€ìˆ˜ ì„¤ì • ì™„ë£Œ
- [ ] User-Agent contact ì´ë©”ì¼ ë³€ê²½ ì™„ë£Œ
- [ ] ë¡œì»¬ì—ì„œ ëª¨ë“  ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸ ì™„ë£Œ

ë°°í¬ í›„ í™•ì¸:
- [ ] ë¸Œë¼ìš°ì € A/Bì—ì„œ ì´ˆëŒ€ì½”ë“œ ìƒì„±/ì°¸ì—¬ í…ŒìŠ¤íŠ¸
- [ ] í´ë” ìƒì„±/ìˆ˜ì •/ì‚­ì œ í…ŒìŠ¤íŠ¸
- [ ] ì¥ì†Œ ì €ì¥ + í´ë” ì§€ì • í…ŒìŠ¤íŠ¸
- [ ] ë§ˆì»¤ ìƒ‰ìƒ/ì•„ì´ì½˜ ë°˜ì˜ í™•ì¸
- [ ] í…Œë§ˆ/ì˜¤ë²„ë ˆì´ íš¨ê³¼ í™•ì¸
- [ ] Cloudflare Dashboardì—ì„œ ìš”ì²­ ìˆ˜ ëª¨ë‹ˆí„°ë§

---

## ë¬¸ì œ í•´ê²°

### ë°°í¬ í›„ API ìš”ì²­ ì‹¤íŒ¨
1. Pages í™˜ê²½ë³€ìˆ˜ `VITE_API_BASE` í™•ì¸
2. Worker URLì´ ì˜¬ë°”ë¥¸ì§€ í™•ì¸
3. ë¸Œë¼ìš°ì € ê°œë°œì ë„êµ¬ Network íƒ­ì—ì„œ ì‹¤ì œ ìš”ì²­ URL í™•ì¸
4. CORS ì—ëŸ¬ì¸ ê²½ìš° Worker ì½”ë“œì˜ CORS í—¤ë” í™•ì¸

### D1 ì¿¼ë¦¬ ì‹¤íŒ¨
1. `workers/wrangler.toml`ì˜ `database_id` í™•ì¸
2. D1 ë°ì´í„°ë² ì´ìŠ¤ê°€ ìƒì„±ë˜ì—ˆëŠ”ì§€ í™•ì¸
3. ìŠ¤í‚¤ë§ˆê°€ ì ìš©ë˜ì—ˆëŠ”ì§€ í™•ì¸
4. Cloudflare Dashboardì—ì„œ D1 ìƒíƒœ í™•ì¸

### ì´ˆëŒ€ì½”ë“œ ê´€ë ¨ ë¬¸ì œ
1. localStorageì— `inviteCode`ê°€ ìˆëŠ”ì§€ í™•ì¸
2. Worker ë¡œê·¸ì—ì„œ `couples` í…Œì´ë¸” ì¿¼ë¦¬ í™•ì¸
3. ì´ˆëŒ€ì½”ë“œ ì¬ë°œê¸‰ í›„ ìƒˆ ì½”ë“œë¡œ í…ŒìŠ¤íŠ¸

---

**ì™„ë£Œ!** ì´ì œ ì™„ì „ ë¬´ë£Œ í‹°ì–´ ì¤‘ì‹¬ ì»¤í”Œ ì§€ë„ì•±ì´ Cloudflareì—ì„œ ë™ì‘í•©ë‹ˆë‹¤! ğŸ‰

